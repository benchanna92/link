<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Phone Repair Auto-Reply Chat with GPT Simulation</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: #f5f7fa;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .chatbox {
    width: 360px;
    max-width: 95vw;
    background: #20232a;
    color: #e1e4ea;
    border-radius: 16px;
    box-shadow: 0 12px 32px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    user-select: none;
    overflow: hidden;
    font-size: 14px;
    z-index: 1000;
  }
  .header {
    background: #24292e;
    padding: 16px;
    font-weight: 600;
    font-size: 18px;
    color: #61dafb;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .close-btn {
    background: transparent;
    border: none;
    color: #61dafb;
    font-size: 22px;
    cursor: pointer;
    padding: 0;
    user-select: none;
    transition: color 0.3s ease;
  }
  .close-btn:hover,
  .close-btn:focus {
    color: #21a1f1;
    outline: none;
  }
  .messages {
    background: #20232a;
    padding: 16px;
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    scrollbar-width: thin;
    scrollbar-color: #61dafb transparent;
  }
  .messages::-webkit-scrollbar {
    width: 8px;
  }
  .messages::-webkit-scrollbar-thumb {
    background-color: #61dafb;
    border-radius: 4px;
  }
  .messages::-webkit-scrollbar-track {
    background: transparent;
  }
  .message {
    max-width: 80%;
    margin-bottom: 12px;
    padding: 12px 16px;
    border-radius: 16px;
    line-height: 1.4;
    word-wrap: break-word;
  }
  .message.user {
    background: #61dafb;
    color: #20232a;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
    box-shadow: 0 2px 6px rgba(97,218,251,0.5);
  }
  .message.gpt {
    background: #2d333b;
    align-self: flex-start;
    border-bottom-left-radius: 4px;
    box-shadow: 0 2px 6px rgba(101,114,133,0.5);
  }
  .whatsapp-link {
    display: inline-block;
    margin: 12px auto 16px auto;
    padding: 10px 20px;
    background: #25D366;
    color: white;
    font-weight: 600;
    border-radius: 24px;
    cursor: pointer;
    text-decoration: none;
    user-select: none;
    font-size: 14px;
    box-shadow: 0 4px 6px rgb(37 211 102 / 0.5);
    transition: background-color 0.3s ease;
    max-width: 80%;
    text-align: center;
  }
  .whatsapp-link:hover,
  .whatsapp-link:focus {
    background-color: #1ebe57;
    outline: none;
  }
  .controls {
    display: flex;
    border-top: 1px solid #3c4048;
    background: #24292e;
    padding: 8px;
  }
  .controls input[type="text"] {
    flex-grow: 1;
    border: none;
    padding: 12px 16px;
    font-size: 14px;
    border-radius: 16px;
    color: #e1e4ea;
    background: #20232a;
  }
  .controls input[type="text"]::placeholder {
    color: #6b7280;
  }
  .controls input[type="text"]:focus {
    outline: none;
    background: #24292e;
  }
  .controls button {
    margin-left: 8px;
    background: #61dafb;
    border: none;
    color: #20232a;
    font-weight: 600;
    padding: 0 20px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 16px;
    transition: background-color 0.3s ease;
  }
  .controls button:hover,
  .controls button:focus {
    background: #21a1f1;
    outline: none;
  }
  /* Bottom finish button */
  .finish-btn {
    margin: 0 auto 16px auto;
    background: #ff6b6b;
    border: none;
    color: white;
    font-weight: 700;
    padding: 12px 24px;
    font-size: 15px;
    border-radius: 24px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(255,107,107,0.6);
    transition: background-color 0.3s ease;
    user-select: none;
    display: none;
  }
  .finish-btn:hover,
  .finish-btn:focus {
    background: #e85c5c;
    outline: none;
  }
  @media (max-width: 420px) {
    .chatbox {
      width: 95vw;
    }
  }
</style>
</head>
<body>
  <section class="chatbox" role="region" aria-label="Phone Repair chat assistant" aria-live="polite" aria-atomic="true">
    <header class="header">
      <h1 style="margin:0; font-size:1.25rem; color:#61dafb;">Phone Repair Assistant</h1>
      <button class="close-btn" aria-label="Close Chatbox" title="Close Chatbox">&times;</button>
    </header>
    <div class="messages" id="messages" role="log" aria-live="polite" aria-relevant="additions"></div>
    <form class="controls" id="chatForm" aria-label="Send message form">
      <input type="text" id="inputField" autocomplete="off" placeholder="Type your message..." aria-required="true" aria-label="Message input" />
      <button type="submit" aria-label="Send message">Send</button>
    </form>
    <button class="finish-btn" id="finishBtn" aria-label="Finish conversation and get case code">Finish Conversation</button>
  </section>

<script>
  (function(){
    const messagesEl = document.getElementById('messages');
    const form = document.getElementById('chatForm');
    const input = document.getElementById('inputField');
    const finishBtn = document.getElementById('finishBtn');
    const closeBtn = document.querySelector('.close-btn');
    const whatsappNumber = '60178040403';

    // State of conversation messages for demonstration GPT response simulation
    const conversationHistory = [];

    // GPT-like simulated responses: simple keyword mapping, fallback random friendly answers
    const gptSimulatedAnswers = [
      "Thanks for telling me. Can you please provide more details?",
      "I see. Is the phone model still under warranty?",
      "That's helpful. Have you tried restarting the device?",
      "Common issue! We can help you fix that quickly.",
      "Could you tell me when the problem started?",
      "Our technicians are experts in that area.",
      "We value your patience. What else can I help with?",
      "Please describe the symptoms a bit more.",
      "Have you noticed any recent updates or damage?",
      "We aim to get your device working like new."
    ];

    // Append message to chat
    function appendMessage(text, sender='gpt') {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message');
      if(sender === 'user') {
        msgDiv.classList.add('user');
        msgDiv.textContent = text;
      } else if(sender === 'gpt') {
        msgDiv.classList.add('gpt');
        msgDiv.textContent = text;
      } else if(sender === 'system') {
        msgDiv.classList.add('gpt');
        msgDiv.style.fontStyle = 'italic';
        msgDiv.textContent = text;
      }
      messagesEl.appendChild(msgDiv);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // Generate 6 digit case number (random numeric string)
    function generateCaseCode() {
      return Math.floor(100000 + Math.random() * 900000).toString();
    }

    // Create WhatsApp link element
    function createWhatsAppLink(caseCode) {
      const baseUrl = `https://wa.me/${whatsappNumber}`;
      const msg = `Hello, I have completed my phone repair conversation. My case number is: ${caseCode}`;
      const url = `${baseUrl}?text=${encodeURIComponent(msg)}`;
      const link = document.createElement('a');
      link.href = url;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.className = 'whatsapp-link';
      link.textContent = 'Send Case Number on WhatsApp';
      link.setAttribute('aria-label', 'Send case number link on WhatsApp');
      return link;
    }

    // Simulate GPT response: choose random response from simulated answers, or canned answers by keyword matching
    function simulateGPTResponse(userMessage) {
      const msg = userMessage.toLowerCase();

      // Basic keyword -> response mapping
      if(msg.includes('screen') || msg.includes('crack') || msg.includes('display')) {
        return "Screen issues are common. We offer reliable replacements. Can you share your phone model?";
      }
      if(msg.includes('battery') || msg.includes('charge') || msg.includes('power')) {
        return "Battery problems can be resolved quickly. How long has the battery been giving trouble?";
      }
      if(msg.includes('software') || msg.includes('update') || msg.includes('error') || msg.includes('crash') || msg.includes('freeze')) {
        return "Software glitches can often be fixed with updates or resets. Have you updated your phone recently?";
      }
      if(msg.includes('water') || msg.includes('liquid') || msg.includes('wet') || msg.includes('damage')) {
        return "Water damage needs immediate attention. Please keep your phone off and bring it to us ASAP.";
      }
      if(msg.includes('price') || msg.includes('cost') || msg.includes('repair') || msg.includes('quote')) {
        return "Costs vary based on issue. Could you provide more details about the problem?";
      }
      if(msg.includes('hello') || msg.includes('hi') || msg.includes('hey')) {
        return "Hello! I'm here to assist you with your phone repair needs. How can I help?";
      }
      if(msg.includes('thank') || msg.includes('thanks')) {
        return "You're welcome! Let me know if there's anything else.";
      }

      // Otherwise random from generic pool
      const idx = Math.floor(Math.random() * gptSimulatedAnswers.length);
      return gptSimulatedAnswers[idx];
    }

    // History push and append message helper
    function userSendsMessage(text) {
      conversationHistory.push({ from: 'user', text });
      appendMessage(text, 'user');
    }
    function gptSendsMessage(text) {
      conversationHistory.push({ from: 'gpt', text });
      appendMessage(text, 'gpt');
    }

    // Disable or enable input controls
    function setInputEnabled(enabled) {
      input.disabled = !enabled;
      form.querySelector('button[type=submit]').disabled = !enabled;
    }

    // Handle form submission (user sends message)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const msg = input.value.trim();
      if(!msg) return;
      userSendsMessage(msg);
      input.value = '';
      setInputEnabled(false);

      // Simulate GPT typing delay
      await new Promise(resolve => setTimeout(resolve, 900));

      const gptReply = simulateGPTResponse(msg);
      gptSendsMessage(gptReply);

      setInputEnabled(true);
      input.focus();
      finishBtn.style.display = 'inline-block'; // show finish button once conversation started
    });

    // Finish conversation: generate case code & show WhatsApp link
    finishBtn.addEventListener('click', () => {
      if (finishBtn.disabled) return;
      finishBtn.disabled = true;
      setInputEnabled(false);
      gptSendsMessage("Thank you for chatting with us. Generating your case number...");
      setTimeout(() => {
        const caseCode = generateCaseCode();
        gptSendsMessage(`Your unique case number is: ${caseCode}`);

        // Append WhatsApp link
        const waLink = createWhatsAppLink(caseCode);
        messagesEl.appendChild(waLink);
        messagesEl.scrollTop = messagesEl.scrollHeight;

        finishBtn.style.display = 'none';
        finishBtn.disabled = false;
        setInputEnabled(false);
      }, 1200);
    });

    // Close chat hide box
    closeBtn.addEventListener('click', () => {
      document.querySelector('.chatbox').style.display = 'none';
    });

    // Initial bot greeting
    gptSendsMessage("Hi! I'm your phone repair assistant powered by GPT. How can I help you today?");
  })();
</script>
</body>
</html>

